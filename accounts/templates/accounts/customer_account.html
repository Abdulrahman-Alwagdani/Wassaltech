{% extends 'main/base.html' %}

{% block content %}

<div class="max-w-2xl mx-auto mt-8 p-6 bg-white rounded-lg shadow-md">
    <h1 class="text-center text-black text-2xl font-bold mb-6">
        تسجيل الدخول كمستفيد
    </h1>
    <div class="flex justify-center border-b border-gray-200">
      <button id="signup-tab" class="py-2 px-4 font-semibold text-gray-600 border-b-2 border-transparent hover:border-orange-500 focus:outline-none" onclick="openTab(event, 'signup')">حساب جديد</button>
        <button id="login-tab" class="py-2 px-4 font-semibold text-gray-600 border-b-2 border-transparent hover:border-orange-500 focus:outline-none" onclick="openTab(event, 'login')">تسجيل الدخول</button>
    </div>

    <div id="login" class="tab-content mt-6">
        <form id="loginForm" action="{% url 'accounts:customer_account' %}" method="post" class="space-y-4" x-data="{ username: '', password: '', showPassword: false }">
            {% csrf_token %}
            <input type="hidden" name="login" value="login">
            {{ form.username.errors }}
            <div class="flex flex-row-reverse">
                <label for="username" class="block text-sm font-medium text-gray-700 mb-1 text-right">اسم المستخدم</label>
                <input class="text-black" id="username" name="username" type="text" placeholder="أدخل اسم المستخدم" 
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 text-right"
                       x-model="username">
            </div>

            {{ form.password.errors }}
            <div class="flex flex-row-reverse relative">
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1 text-right">كلمة المرور</label>
                <input class="text-black" :type="showPassword ? 'text' : 'password'" id="password" name="password" placeholder="أدخل كلمة المرور" 
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 text-right pr-10"
                       x-model="password">
                <button type="button" class="absolute inset-y-0 left-0 pr-3 flex items-center" @click="showPassword = !showPassword">
                    <svg class="h-5 w-5 text-gray-400" fill="none" @click="showPassword = !showPassword"
                         :class="{'hidden': !showPassword, 'block':showPassword }" xmlns="http://www.w3.org/2000/svg"
                         viewbox="0 0 576 512">
                        <path fill="currentColor"
                              d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z">
                        </path>
                    </svg>

                    <svg class="h-5 w-5 text-gray-400" fill="none" @click="showPassword = !showPassword"
                         :class="{'block': !showPassword, 'hidden':showPassword }" xmlns="http://www.w3.org/2000/svg"
                         viewbox="0 0 640 512">
                        <path fill="currentColor"
                              d="M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z">
                        </path>
                    </svg>
                </button>
            </div>

            <button type="submit" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"
                    :disabled="!username || !password" 
                    :class="{ 'opacity-50 cursor-not-allowed': !username || !password }">
                تسجيل الدخول
            </button>
        </form>
    </div>

    <div id="signup" class="tab-content mt-6" style="display:none;">
        <form id="signupForm" action="{% url 'accounts:customer_account' %}" method="post" class="space-y-4" x-data="{ username: '', email: '', first_name: '', last_name: '', password: '', confirmPassword: '', phone_number: '', address: '', showPassword: false, showConfirmPassword: false }">
            {% csrf_token %}
            <input class="text-black" type="hidden" name="signup" value="signup" />

            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                <div class="col-span-2">
                    <label for="signup-username" class="block text-sm font-medium text-gray-700 text-right">اسم المستخدم</label>
                    <input class="text-black" id="signup-username" name="username" type="text" placeholder="أدخل اسم المستخدم" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 text-right" 
                           required x-model="username">
                </div>

                <div class="col-span-2">
                    <label for="email" class="block text-sm font-medium text-gray-700 text-right">البريد الإلكتروني</label>
                    <input class="text-black" id="email" name="email" type="email" placeholder="أدخل البريد الإلكتروني" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 text-right" 
                           required x-model="email">
                </div>

                <div>
                    <label for="first_name" class="block text-sm font-medium text-gray-700 text-right">الإسم الأول</label>
                    <input class="text-black" id="first_name" name="first_name" placeholder="أدخل الإسم الأول" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 text-right" 
                           required x-model="first_name">
                </div>

                <div>
                    <label for="last_name" class="block text-sm font-medium text-gray-700 text-right">الإسم الثاني</label>
                    <input class="text-black" id="last_name" name="last_name" placeholder="أدخل الإسم الثاني" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 text-right" 
                           required x-model="last_name">
                </div>

            <div>
                <label class="label">
                    <span class="label-text">أدخل الصورة الشخصية</span>
                </label>
                <input name="avatar" accept="image/*" placeholder="الصورة الشخصية"  class="file-input file-input-bordered w-full max-w-xs" id="avatar" type="file">
            </div>

            <div>
                <label class="label">
                    <span class="label-text">كلمة المرور</span>
                </label>
                <input id="pass" name="password" type="password" placeholder="أدخل كلمة المرور"
                    class="input input-bordered w-full" required />
            </div>

                <div class="relative">
                    <label for="confirmpass" class="block text-sm font-medium text-gray-700 text-right">تأكيد كلمة المرور</label>
                    <input class="text-black" id="confirmpass" :type="showConfirmPassword ? 'text' : 'password'" placeholder="أعد إدخال كلمة المرور" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 text-right pr-10" 
                           required x-model="confirmPassword">
                    <button type="button" class="absolute inset-y-0 left-0 pr-3 flex items-center" @click="showConfirmPassword = !showConfirmPassword">
                        <svg class="h-5 w-5 text-gray-400" fill="none" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 576 512"
                             :class="{'hidden': !showConfirmPassword, 'block':showConfirmPassword }">
                            <path fill="currentColor"
                                  d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z">
                            </path>
                        </svg>
                        <svg class="h-5 w-5 text-gray-400" fill="none" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 640 512"
                             :class="{'block': !showConfirmPassword, 'hidden':showConfirmPassword }">
                            <path fill="currentColor"
                                  d="M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z">
                            </path>
                        </svg>
                    </button>
                </div>

                <div>
                    <label for="phone_number" class="block text-sm font-medium text-gray-700 text-right">رقم الهاتف</label>
                    <input class="text-black" id="phone_number" name="phone_number" type="tel" placeholder="أدخل رقم الهاتف" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 text-right" 
                           required x-model="phone_number">
                </div>

                <div>
                    <label for="address" class="block text-sm font-medium text-gray-700 text-right">العنوان</label>
                    <input class="text-black" id="address" name="address" type="text" placeholder="أدخل العنوان" 
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 text-right" 
                           required x-model="address">
                </div>
            </div>

            <button type="submit" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"
                    :disabled="!username || !email || !first_name || !last_name || !password || !confirmPassword || !phone_number || !address || password !== confirmPassword"
                    :class="{ 'opacity-50 cursor-not-allowed': !username || !email || !first_name || !last_name || !password || !confirmPassword || !phone_number || !address || password !== confirmPassword }">
                إنشاء حساب
            </button>
        </form>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
    function openTab(evt, tabName) {
        let i, tabContent, tabLinks;
        tabContent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabContent.length; i++) {
            tabContent[i].style.display = "none";
        }
        tabLinks = document.getElementsByClassName("py-2 px-4 font-semibold text-gray-600 border-b-2 border-transparent hover:border-orange-500 focus:outline-none");
        for (i = 0; i < tabLinks.length; i++) {
            tabLinks[i].className = tabLinks[i].className.replace(" border-orange-500 text-orange-600", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " border-orange-500 text-orange-600";
        localStorage.setItem('currentTabCustomer', tabName);
    }

    document.getElementById("login").style.display = "block";

    function validateForm() {
        var password = document.getElementById("pass").value;
        var confirmPassword = document.getElementById("confirmpass").value;
        if (password != confirmPassword) {
            showMessage("كلمات المرور غير متطابقة", "error");
            return false;
        }
        return true;
    }

    function showMessage(message, type) {
        const messagesDiv = document.createElement('div');
        messagesDiv.className = `fixed top-0 left-1/2 transform -translate-x-1/2 mt-4 p-4 rounded-md ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
        messagesDiv.textContent = message;
        document.body.appendChild(messagesDiv);

        setTimeout(() => {
            messagesDiv.remove();
        }, 5000);
    }

    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = this.querySelector('input[name="username"]').value;
        const password = this.querySelector('input[name="password"]').value;

        if (!username || !password) {
            showMessage('الرجاء إدخال اسم المستخدم وكلمة المرور', 'error');
            return;
        }

        this.submit();
    });

    document.getElementById('signupForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const password = this.querySelector('#pass').value;
        const confirmPassword = this.querySelector('#confirmpass').value;

        if (password !== confirmPassword) {
            showMessage('كلمات المرور غير متطابقة', 'error');
            return;
        }
        this.submit();
    });

    window.onload = function() {
      const currentTab = localStorage.getItem('currentTabCustomer') || 'login';
      document.getElementById(currentTab + '-tab').click();
  }
</script>
{% endblock %}
